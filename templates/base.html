{% load static %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Farmacorp{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <script src="{% static 'js/alertas.js' %}"></script>
    <script src="{% static 'js/chart.js' %}"></script>
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>

<body class="bg-light">
    
    <!--NAVBAR SUPERIOR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm">
        <div class="container-fluid">
            <!-- Logo -->
            <a class="navbar-brand d-flex align-items-center" href="{% url 'dashboard' %}">
                <img src="{% static 'img/farmacorp_logo.png' %}" alt="Farmacorp" style="height:40px;" class="me-2">
                <strong>Farmacorp</strong>
            </a>

            <!-- Menú -->
            <ul class="navbar-nav ms-auto">
                {% if user.is_authenticated %}
                <nav class="navbar navbar-expand-lg navbar-dark bg-success shadow-sm">
                <li class="nav-item"><a class="nav-link" href="{% url 'clientes:list' %}">Clientes</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'empleados:list' %}">Empleados</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'productos:list' %}">Productos</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'productos:listp' %}">Proveedores</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'ventas:venta_list' %}">Ventas</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'reportes:list' %}">Reportes</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'inventario:list' %}">Inventario</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'farmacia:list' %}">Farmacia</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'farmacia:listf' %}">Sucursal</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'recetas:list' %}">Receta</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'productos:listc' %}">Compras</a></li>
                <li class="nav-item"><a class="nav-link" href="{% url 'usuario:list' %}">Usuarios</a></li>
                <!-- Alertas en vivo -->
                <li class="nav-item dropdown">
                    <a class="nav-link position-relative" href="#" id="alertDropdown" data-bs-toggle="dropdown">
                        
                        <span id="alertCount" class="badge bg-danger position-absolute top-0 start-100 translate-middle">0</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" id="alertList">
                        <li><span class="dropdown-item">Cargando alertas...</span></li>
                    </ul>
                </li>
                </nav>
                {% endif %}
                <!--Cerrar sesión -->
                <li class="nav-item">
                    <a class="nav-link text-white" href="{% url 'usuario:logout' %}">Salir</a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- CONTENIDO -->
    <main class="container my-4">
        {% block content %}
        {% endblock %}
    </main>

    <!-- FOOTER -->
    <footer class="bg-success text-white text-center py-3 mt-auto">
        <p class="mb-0">&copy; 2025 Farmacorp — Todos los derechos reservados</p>
    </footer>

    <!-- JS Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Alertas en tiempo real -->
    <script>
        async function cargarAlertas() {
            try {
                const response = await fetch("{% url 'alertas:api_alertas' %}");
                const data = await response.json();

                // Contador
                document.getElementById("alertCount").innerText = data.count;

                // Lista
                const alertList = document.getElementById("alertList");
                alertList.innerHTML = "";
                if (data.alertas.length > 0) {
                    data.alertas.forEach(a => {
                        let li = document.createElement("li");
                        li.innerHTML = `<span class='dropdown-item'><b>${a.tipo}</b>: ${a.descripcion} (${a.producto})</span>`;
                        alertList.appendChild(li);
                    });
                } else {
                    alertList.innerHTML = "<li><span class='dropdown-item'>No hay alertas</span></li>";
                }
            } catch (error) {
                console.error("Error cargando alertas:", error);
            }
        }

        // Cargar cada 10 segundos
        setInterval(cargarAlertas, 10000);
        cargarAlertas();
    </script>

    {% block extra_js %}{% endblock %}
</body>
</html>


